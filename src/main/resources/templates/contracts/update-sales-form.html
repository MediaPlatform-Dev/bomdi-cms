<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<div th:replace="~{fragments/head}">
</div>
<body>
	<div class="wrap">
		<nav th:replace="~{fragments/side-navigation-bar}"></nav>
		<!-- content start -->
		<div class="container">
			<header th:replace="~{fragments/header}"></header>
			<div class="header">
				<h2>
					매출 계약서 수정
				</h2>
			</div>
			<!--계약 유형-->
			<div class="content">
				<form method="post" th:action="@{/contracts/{id}/update-sales-form (id=${contract.id})}" onsubmit="return updateContract()" th:object="${form}" enctype="multipart/form-data">
					<input type="hidden" name="_method" value="PUT">
					<div class="subTitle02">
						<h3>매출 계약유형</h3>
					</div>
					<div class="tbl_type02">
						<table>
						<colgroup>
							<col style="width: 15%">
							<col style="width: 85%">
						</colgroup>
						<tr>
							<th>매출 계약유형</th>
							<td>
								<div class="mz-chkbxset">
									<div class="chkbx">
										<input type="checkbox" id="Infra" name="Infra" value="Infra"
												onchange="toggleSectionVisibility('Infra', 'infra-section');"
												th:checked="${contract.getContractDetailTypes().contains('Infra')}"/>
										<label for="Infra">Infra</label>
									</div>
									<div class="chkbx">
										<input type="checkbox" id="PS" name="PS" value="PS"
												onchange="toggleSectionVisibility('PS', 'ps-section');"
												th:checked="${contract.getContractDetailTypes().contains('PS')}"/>
										<label for="PS">PS</label>
									</div>
									<div class="chkbx">
										<input type="checkbox" id="MS" name="MS" value="MS"
												onchange="toggleSectionVisibility('MS', 'ms-section');"
												th:checked="${contract.getContractDetailTypes().contains('MS')}"/>
										<label for="MS">MS</label>
									</div>
									<div class="chkbx">
										<input type="checkbox" id="DP" name="DP" value="DP"
												onchange="toggleSectionVisibility('DP', 'dp-section');"
												th:checked="${contract.getContractDetailTypes().contains('DP')}"/>
										<label for="DP">DP</label>
									</div>
								</div>
							</td>
						</tr>
						</table>
					</div>

					<!--계약 기본정보1-->
					<div class="section">
						<div class="subTitle02">
							<h3>계약 기본정보 1</h3>
						</div>
						<div class="tbl_type02">
							<table>
							<colgroup>
								<col style="width: 25%;">
								<col style="width: 25%;">
								<col style="width: 25%;">
								<col>
							</colgroup>
							<tr>
								<th>매출 계약번호</th>
								<td>
									<input readonly type="text" class="inputArea" th:value="${contract.no()}" placeholder="매출 계약번호" style="width: 100%;">
								</td>

								<th>계약일</th>
								<td colspan="2">
									<div class="search">
										<input type="text" th:id="contractDate" th:name="contractDate" th:value="${contract.contractDate()}" style="width: 100%;" />
									</div>
								</td>
							</tr>
							<tr>
								<th>매출 계약명</th>
								<td colspan="5">
									<input type="text" class="inputArea" th:id="name" th:name="name" th:value="${contract.name}" placeholder="매출 계약명" style="width: 67%;">
								</td>
							</tr>
							<tr>
								<th>Salesforce 계약번호</th>
								<td colspan="5">
									<input type="text" class="inputArea" th:id="salesForceContractNo" th:name="salesForceContractNo" th:field="${contract.salesForceContractNo}" style="width: 67%;" placeholder="Salesforce 계약번호">
								</td>
							</tr>
							<tr>
								<th>매출 승인 여부</th>
								<td colspan="5">
									<input readonly type="text" class="inputArea" th:value="${contract.isApproved()}" placeholder="매출 승인 여부" style="width: 32%;">
								</td>
							</tr>
							<tr>
								<th>매출 갱신 여부</th>
								<td>
									<div class="mz-chkbxset">
										<div class="chkbx">
											<input type="checkbox" />
										</div>
									</div>
								</td>

								<th>갱신전 매출 계약번호</th>
								<td>
									<input type="text" class="inputArea" th:id="beforeRenewalContractNo" th:name="beforeRenewalContractNo" th:value="${contract.beforeRenewalContractNo}" style="width: 100%;" placeholder="갱신전 매출 계약번호">
								</td>
							</tr>
							</table>
						</div>
					</div>

					<div class="subTitle02">
						<h3>계약 기본정보 2</h3>
					</div>
					<div class="tbl_type02">
						<table>
						<colgroup>
							<col style="width: 25%;">
							<col style="width: 25%;">
							<col style="width: 25%;">
							<col>
						</colgroup>
						<tr>
							<th>접수 방법 구분</th>
							<td>
								<select th:field="${form.submissionType}" style="width:100%;">
									<option th:each="type : ${form.submissionType}"
											th:value="${type.name}"
											th:text="${type.description}">
									</option>
								</select>
							</td>

							<th>자사법인</th>
							<td>
								<!--TODO: ENUM 타입으로 변환 후 응답-->
								<select style="width:100%;">
									<option>메가존 클라우드
									</option>
									<option>메가존 디지털
									</option>
								</select>
							</td>
						</tr>
						<tr>
							<th>서비스 분류</th>
							<td>
								<select style="width:100%;">
									<option>AWS
									</option>
									<option>Azure
									</option>
									<option>GCP
									</option>
								</select>
							</td>

							<th>체결 분류</th>
							<td>
								<select th:id="dealType" th:name="dealType" style="width:100%;">
									<option th:each="type : ${contract.dealType.values}"
											th:value="${type.name}"
											th:text="${type.description}">
									</option>
								</select>
							</td>
						</tr>
						<tr>
							<th>거래처</th>
							<td colspan="5">
								<div class="search">
									<input class="inputArea" style="width: 40%;" type="text" value="" placeholder="거래처명">
									<a onclick="openCustomerPopup();" class="btn_s mL5">검색 </a>
								</div>
							</td>
						</tr>
						<tr>
							<th>계약금액</th>
							<td colspan="5">
								<div class="mz-radioset mT10">
									<div class="mz-radio">
										<input type="radio" checked="">
										<label>고정 금액</label>
									</div>
									<div class="mz-radio">
										<input type="radio" value="">
										<label>종량제 과금제</label>
									</div>
								</div>

								<div>
									<select th:field="${form.paymentType}" style="width:100%;">
										<option th:each="type : ${form.paymentType.values}"
												th:value="${type.name}"
												th:text="${type.description}">
										</option>
									</select>

									<input type="text" class="inputArea" th:id="amount" th:name="amount" th:value="${contract.amount()}" style="width: 50%;">
									<input type="text" class="inputArea" th:id="vat" th:name="vat" th:value="${contract.amount()}" style="width: 50%;">

									<select th:id="currencyUnitType" th:name="currencyUnitType" style="width:100%;">
										<option th:each="type : ${contract.currencyUnitType.values}"
												th:value="${type.name}"
												th:text="${type.description}">
										</option>
									</select>

									<input type="checkbox" /> 부가세 포함

								</div>

								<div>
									<input type="checkbox" /> 선납금 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
									<!--<input class="inputArea" th:field="*{advancePaymentAmount}" style="width: 50%;" type="text" value="0">-->
									<select th:id="advancePaymentCurrencyUnitType" th:name="advancePaymentCurrencyUnitType" style="width:100%;">
										<option th:each="type : ${contract.currencyUnitType.values}"
												th:value="${type.name}"
												th:text="${type.description}">
										</option>
									</select>
								</div>

								<div>
									특이사항
									<input type="text" class="inputArea" th:id="contractAmountRemark" th:name="contractAmountRemark" th:value="${contract.description()}" style="width: 50%;">
								</div>

							</td>
						</tr>
						<tr>
							<th>계약기간</th>
							<td colspan="2">
								<div class="search">
									<input type="text" th:field="${form.contractStartDate}" style="width: 100%;" id="datePickerContractStartDate" data-mindate="today" />
									<p class="mL10 mR10">~</p>
									<input th:field="${form.contractEndDate}" style="width: 100%;" type="text" id="datePickerContractEndDate" data-mindate="today" />
								</div>
							</td>
							<td>
								<div class="mz-chkbxset">
									<div class="chkbx">
										<input type="checkbox" /> 종료일 해지 시까지로 설정
									</div>
								</div>
							</td>
						</tr>
						<tr>
							<th>청구기간</th>
							<td colspan="2">
								<div class="search">
									<input type="text" th:id="invoiceStartDate" th:name="invoiceStartDate" th:value="${contract.contractStartDate()}" data-mindate="today" style="width: 100%;" />
									<p class="mL10 mR10">~</p>
									<input type="text" th:id="invoiceEndDate" th:name="invoiceEndDate" th:value="${contract.contractEndDate()}" data-mindate="today" style="width: 100%;" />
								</div>
							</td>
							<td>
								<div class="mz-chkbxset">
									<div class="chkbx">
										<input type="checkbox" /> 계약기간과 동일
									</div>
								</div>
							</td>
						</tr>
						<tr>
							<th>지불조건</th>
							<td colspan="5">
								<div>
									<input type="radio" name="status" id="status01" value="">
									<label for="status01">익월</label>

									<select style="width:10%;">
										<option>1
										</option>
										<option>2
										</option>
									</select>
									일 이내 세금계산서 발행 후 말일 이내 계좌이체 지불
								</div>

								<div>
									<input type="radio" name="status" id="status02" value="">
									<label for="status01">익월</label>

									<select style="width:10%;">
										<option>1
										</option>
										<option>2
										</option>
									</select>
									일 이내 신용카드 결제
								</div>

								<div>
									<input type="radio" name="status" id="status03" value="">
									<label for="status01">기타</label>

									<input class="inputArea" style="width: 80%;" type="text" value="" placeholder="">
								</div>

							</td>

						</tr>
						<tr>
							<th>계약팀 담당자</th>
							<td>
								<div class="search">
									<input type="text" class="inputArea" th:id="contractManagerName" th:name="contractManagerName" th:value="${contract.contractorName()}" placeholder="계약팀 담당자" style="width: 100%;">
									<a onclick="openChargerPopup();" class="btn_s mL5">검색</a>
								</div>
							</td>

							<th>세일즈 담당자</th>
							<td>
								<div class="search">
									<input type="text" class="inputArea" th:id="salesManagerName" th:name="salesManagerName" th:value="${contract.salesPersonName()}" placeholder="세일즈 담당자" style="width: 100%;">
									<a onclick="openChargerPopup();" class="btn_s mL5">검색</a>
								</div>
							</td>
						</tr>

						<tr>
							<th>EDM Link URL</th>
							<td colspan="5">
								<input class="inputArea" style="width: 67%;" type="text" value="">
							</td>
						</tr>

						<tr>
							<th>청구방법</th>
							<td colspan="5">
								<select th:field="${form.invoiceType}" style="width:100%;">
									<option th:each="type : ${form.invoiceType.values}"
											th:value="${type.name}"
											th:text="${type.description}">
									</option>
								</select>
							</td>
						</tr>

						<tr>
							<th>세금계산서 작성일</th>
							<td>
								<select style="width:100%;">
									<option>당월(말일)
									</option>
									<option>익월(1일)
									</option>
									<option>기타
									</option>
								</select>
							</td>

							<th>세금계산서 수신 메일</th>
							<td>
								<input type="text" class="inputArea" th:id="taxReceivedEmail" th:name="taxReceivedEmail" th:value="${form.taxReceivedEmail}" placeholder="메일 주소" style="width: 100%;">
							</td>
						</tr>


						<tr>
							<th>AWS 통합 빌링(신규)</th>
							<td colspan="5">
								<div class="mz-chkbxset">
									<div class="chkbx">
										<input type="checkbox" />
									</div>
								</div>
							</td>
						</tr>


						<tr>
							<th>특이사항</th>
							<td colspan="5">
								<textarea th:id="remark" th:name="remark" th:value="${contract.description}" style="width: 100%; height:100px;"></textarea>
							</td>
						</tr>


						</table>
					</div>

					<div class="section">
						<div class="subTitle02">
							<h3>고객사 담당자</h3>
							<div>
								<button type="button" class="btn btn-add" onclick="addClient()">담당자 추가</button>
							</div>
						</div>
						<div class="tbl_type02">
							<table id="forList">
							<colgroup>
								<col width="10%">
								<col width="20%">
								<col width="20%">
								<col>
								<col width="20%">
							</colgroup>
							<tr>
								<th class="center">No</th>
								<th class="center">담당자 구분</th>
								<th class="center">이름</th>
								<th class="center">이메일</th>
								<th class="center">비고</th>
							</tr>
							<tr th:each="clientInfo, stat : ${contract.clientInfos}">
								<td class="center" th:text="${stat.index} + 1"></td>
								<td>
									<input type="text" class="inputArea" th:value="'구분'" style="width: 100%;" placeholder="구분" />
								</td>
								<td>
									<input type="text" class="inputArea" th:id="'clientInfos[' + __${stat.index}__ + '].name'" th:name="'clientInfos[' + __${stat.index}__ + '].name'" th:value="${clientInfo.name}" style="width: 100%;" placeholder="이름" />
								</td>
								<td>
									<input type="text" class="inputArea" th:id="'clientInfos[' + __${stat.index}__ + '].email'" th:name="'clientInfos[' + __${stat.index}__ + '].email'" th:value="${clientInfo.email}" style="width: 100%;" placeholder="이메일" />
								</td>
								<td>
									<input type="text" class="inputArea" th:id="'clientInfos[' + __${stat.index}__ + '].etc'" th:name="'clientInfos[' + __${stat.index}__ + '].etc'" th:value="${clientInfo.etc}" style="width: 100%;" placeholder="비고" />
								</td>
							</tr>
							</table>
						</div>
					</div>

					<div class="tbl_type02">
						<h3 th:style="'margin:30px 0px 0px 0px'">증빙 서류</h3>
						<table>
						<colgroup>
							<col style="width:15%;">
							<col>
						</colgroup>
						<tr>
							<th class="center">계약서</th>
							<td>
								<input type="file" th:text="'선택된 파일 없음'" />
							</td>
						</tr>
						<tr>
							<th class="center">사업자 등록증</th>
							<td>
								<input type="file" th:text="'선택된 파일 없음'" />
							</td>
						</tr>
						<tr>
							<th class="center">비밀유지계약서</th>
							<td>
								<input type="file" th:text="'선택된 파일 없음'" />
							</td>
						</tr>
						<tr>
							<th class="center">첨부문서</th>
							<td>
								<div>
									<input type="file" th:text="'이용계약 일반조건'" />
								</div>
								<div>
									<input type="file" th:text="'서비스 상세'" />
								</div>
								<div>
									<input type="file" th:text="'환율 정책'" />
								</div>
							</td>
						</tr>
						<tr>
							<th class="center">특이사항</th>
							<td>
								<p th:id="documentRemark" th:name="documentRemark" th:value="${contract.description()}">
							</td>
						</tr>
						</table>
					</div>


					<div class="section" id="infra-section" style="display: none">
						<div class="subTitle02">
							<h3>AWS</h3>
							<input type="text" class="inputArea" th:id="awsDetail.name" th:name="awsDetail.name" th:value="'임시'" placeholder="이름" th:disabled="true"/>
						</div>
					</div>

					<div class="section" id="ps-section" style="display: none">
						<div class="subTitle02">
							<h3>PS</h3>
							<input type="text" class="inputArea" th:id="psDetail.name" th:name="psDetail.name" th:value="'임시'" placeholder="이름" th:disabled="true"/>
						</div>
					</div>

					<div class="section" id="ms-section" style="display: none">
						<div class="subTitle02">
							<h3>MS</h3>
							<input type="text" class="inputArea" th:id="msDetail.name" th:name="msDetail.name" th:value="'임시'" placeholder="이름" th:disabled="true"/>
						</div>
					</div>

					<div class="section" id="dp-section" style="display: none">
						<div class="subTitle02">
							<h3>DP</h3>
							<input type="text" class="inputArea" th:id="dpDetail.name" th:name="dpDetail.name" th:value="'임시'" placeholder="이름" th:disabled="true"/>
						</div>
					</div>

					<!-- 등록 버튼 -->
					<div class="btn-wrap">
						<button class="btn btn-blue" type="submit" name="action" value="TEMPORARY">수정</button>
						<button class="btn btn-navy" type="submit" name="action" value="SAVED">저장</button>
						<a class="btn btn-wt" th:href="@{/contracts}">취소</a>
					</div>
					<!-- 버튼 -->
				</form>
			</div>
			<!-- content end -->
		</div>

		<script>
          const rowCount = document.getElementById("forList")
            .getElementsByTagName("tr")
            .length;
          let rowIndex = rowCount - 1;
          const fields = {
            type: "담당자 구분",
            name: "이름",
            email: "이메일",
            etc: "비고"
          }

          function addClient() {
            const table = document.getElementById('forList');
            const newRow = table.insertRow(-1);

            const indexCell = newRow.insertCell(0);
            indexCell.classList.add('center');
            indexCell.textContent = rowIndex + 1;

            Object.keys(fields)
              .forEach((fieldKey, index) => {
                const cell = newRow.insertCell(index + 1);
                const input = document.createElement('input');
                input.classList.add('inputArea');
                input.style.width = '100%';
                input.type = 'text';
                input.value = '';
                input.placeholder = fields[fieldKey];
                input.id = `clientInfos${rowIndex}.${fieldKey}`;
                input.name = `clientInfos[${rowIndex}].${fieldKey}`;
                cell.appendChild(input);
              });
            rowIndex++;
          }
		</script>

		<script>
          $(function () {
            $('#contractDate, #datePickerContractStartDate, #datePickerContractEndDate, #datePickerInvoiceStartDate, #datePickerInvoiceEndDate')
              .datepicker();
          });

          function updateContract() {
            const isCreated = confirm("계약을 등록하시겠습니까?");
            if (isCreated) {
              $("input[type='radio']")
                .attr("disabled", false);
              $("select")
                .attr("disabled", false);
            }
            return isCreated;
          }

          function toggleSectionVisibility(checkboxId, sectionId) {
            const checkbox = document.getElementById(checkboxId);
            const section = document.getElementById(sectionId);

            if (!checkbox.checked) {
              section.style.display = 'none';
              changeInputState(section, false);
              return;
            }

            section.style.display = 'block';
            changeInputState(section, true);
          }

          function changeInputState(section, isEnabled) {
            const inputElements = section.querySelectorAll('input');

            inputElements.forEach((input) => {
              input.disabled = !isEnabled;
            });
          }
		</script>

	</div>
</body>
</html>
