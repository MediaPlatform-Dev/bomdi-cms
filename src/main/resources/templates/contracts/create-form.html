<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head}">
	<title>제목</title>
</head>
<body>
	<div class="wrap">
		<nav th:replace="~{fragments/side-navigation-bar}"></nav>
		<!-- content start -->
		<div class="container">
			<header th:replace="~{fragments/header}"></header>
			<div class="content">
				<form method="post" th:action="@{/contracts/form}" onsubmit="return createContract()" th:object="${form}" enctype="multipart/form-data">
					<!-- 입력1 -->
					<div class="section">
						<div class="subTitle02">
							<h3>계약유형</h3>
						</div>
						<div class="tbl_type02">
							<table>
							<colgroup>
								<col style="width: 15%;">
								<col style="width: 18%;">
								<col style="width: 15%;">
								<col style="width: 18%;">
								<col style="width: 15%;">
								<col>
							</colgroup>
							<tr>
								<th>계약 구분 1</th>
								<td>
									<div class="mz-radioset">
										<div th:each="type : *{contractType.values}" class="mz-radio">
											<input type="radio" th:field="*{contractType}" th:value="${type.name}" checked="">
											<label th:for="${#ids.prev('contractType')}" th:text="${type.type}"></label>
										</div>
									</div>
								</td>
								<th>계약 구분 2</th>
								<td>
									<select th:field="*{contractType2}" style="width:100%;">
										<option th:each="type : *{contractType2.values}"
												th:value="${type.name}"
												th:text="${type.type}">
										</option>
									</select>
								</td>
								<th>계약 구분 3</th>
								<td>
									<select th:field="*{contractType3}" style="width:100%;">
										<option th:each="type : *{contractType3.values}"
												th:value="${type.name}"
												th:text="${type.type}">
										</option>
									</select>
								</td>
							</tr>
							</table>
						</div>
					</div>
					<!-- 입력 1 -->
					<!-- 입력 2 -->
					<div class="section">
						<div class="subTitle02">
							<h3>계약 기본정보 1</h3>
						</div>
						<div class="tbl_type02">
							<table>
							<colgroup>
								<col style="width: 15%;">
								<col style="width: 18%;">
								<col style="width: 15%;">
								<col style="width: 18%;">
								<col style="width: 15%;">
								<col>
							</colgroup>
							<tr>
								<th>매출 승인</th>
								<td>
									<div class="chkbx">
										<input type="checkbox" th:field="*{isSalesApproved}">
										<label th:for="isSalesApproved">승인</label>
									</div>
								</td>
								<th>매출 갱신</th>
								<td>
									<div class="chkbx">
										<input type="checkbox" th:field="*{isSalesUpdated}">
										<label th:for="isSalesUpdated">승인</label>
									</div>
								</td>
								<th>매출 계약번호</th>
								<td><input class="inputArea" th:field="*{salesContractId}" style="width: 100%;" type="text" value="" placeholder="매출 계약 번호"></td>
							</tr>
							<tr>
								<th th:for="beforeUpdateSalesId">갱신전 매출 계약번호</th>
								<td>
									<input th:field="*{beforeUpdateSalesId}" required
											class="inputArea" style="width: 100%;" type="text" value="" placeholder="갱신전 매출 계약번호">
									<div class="invalid-feedback">
										<p th:if="${#fields.hasErrors('beforeUpdateSalesId')}" th:errors="*{beforeUpdateSalesId}">Invalid value</p>
									</div>
								</td>

								<th th:for="salesForceContractId">Sales Force 계약번호</th>
								<td>
									<input th:field="*{salesForceContractId}" required
											class="inputArea" style="width: 100%;" type="text" value="" placeholder="Sales Force 계약번호">
									<div class="invalid-feedback">
										<p th:if="${#fields.hasErrors('salesForceContractId')}" th:errors="*{salesForceContractId}">Invalid value</p>
									</div>
								</td>
								<td></td>
								<td></td>
							</tr>
							<tr>
								<th th:for="name">계약명</th>
								<!--<td colspan="5"><input class="inputArea" style="width: 100%;" type="text" value="" placeholder="계약명"></td>-->
								<td colspan="5">
									<input th:field="*{name}" required
											class="inputArea" style="width: 100%;" type="text" value="" placeholder="계약명">
									<div class="invalid-feedback">
										<p th:if="${#fields.hasErrors('name')}" th:errors="*{name}">Invalid value</p>
									</div>
								</td>
							</tr>
							</table>
						</div>
					</div>
					<!-- 입력 2 -->
					<!-- 입력 3 -->
					<div class="section">
						<div class="subTitle02">
							<h3>계약 기본정보 2</h3>
						</div>
						<div class="tbl_type02">
							<table>
							<colgroup>
								<col style="width: 15%;">
								<col style="width: 18%;">
								<col style="width: 15%;">
								<col style="width: 18%;">
								<col style="width: 15%;">
								<col>
							</colgroup>
							<tr>
								<th>접수 방법 구분</th>
								<td>
									<select th:field="*{submissionType}" style="width:100%;">
										<option th:each="type : *{submissionType.values}"
												th:value="${type.name}"
												th:text="${type.name}">
										</option>
									</select>
								</td>
								<th>자사 법인</th>
								<td>
									<select th:field="*{ownCorporationType}" style="width:100%;">
										<option th:each="type : *{ownCorporationType.values}"
												th:value="${type.name}"
												th:text="${type.type}">
										</option>
									</select>
								</td>
								<th>서비스 분류</th>
								<td>
									<select th:field="*{serviceType}" style="width:100%;">
										<option th:each="type : *{serviceType.values}"
												th:value="${type.name}"
												th:text="${type.type}">
										</option>
									</select>
								</td>
							</tr>
							<tr>
								<th>체결 분류</th>
								<td>
									<select style="width:100%;">
										<option th:each="type : *{dealType.values}"
												th:value="${type.name}"
												th:text="${type.type}">
										</option>
									</select>
									<!--<input class="inputArea" style="width: 100%;" type="text" value="" placeholder="체결분류">-->
								</td>
								<th>거래처 구분</th>
								<td>
									<select th:field="*{businessPartnerType}" style="width:100%;">
										<option th:each="type : *{businessPartnerType.values}"
												th:value="${type.name}"
												th:text="${type.type}">
										</option>
									</select>
								</td>
								<td></td>
								<td></td>
							</tr>
							<tr>
								<th>거래처명</th>
								<td colspan="5">
									<div class="search">
										<input th:field="*{businessPartnerName}" class="inputArea readonly" style="width: 100%;" type="text" value="" placeholder="거래처명" readonly>
										<a class="btn_s mL5">검색 </a>
									</div>
								</td>

							</tr>
							<tr>
								<th>계약 금액</th>
								<td colspan="2">
									<div class="search">
										<select th:field="*{currencyUnit}" style="width:100%;">
											<option th:each="type : *{currencyUnit.values}"
													th:value="${type.name}"
													th:text="${type.name}">
											</option>
										</select>
										<input th:field="*{totalContractAmount}" class="inputArea mL5" style="width: 100%;" type="text" value="" placeholder="금액">
									</div>
								</td>
								<td></td>
								<td></td>
								<td></td>
							</tr>
							<tr>
								<th>계약 기간</th>
								<td colspan="2">
									<div class="search">
										<input class="inputDate" style="width: 100%;" type="text" id="datePickerStart" data-mindate="today" />
										<p class="mL10 mR10">~</p>
										<input class="inputDate" style="width: 100%;" type="text" id="datePickerEnd" data-mindate="today" />
									</div>
								</td>
								<td></td>
								<td></td>
								<td></td>
							</tr>
							<tr>
								<th>계약팀 담당자</th>
								<td>
									<div class="search">
										<input class="inputArea" style="width: 100%;" type="text" value="" placeholder="계약팀 담당자" readonly th:field="*{contractor}">
										<a class="btn_s mL5">검색</a>
									</div>
								</td>
								<th>세일즈 담당자</th>
								<td>
									<div class="search">
										<input class="inputArea" style="width: 100%;" type="text" value="" placeholder="세일즈 담당자" readonly th:field="*{salesPersonName}">
										<a class="btn_s mL5">검색</a>
									</div>
								</td>
								<td></td>
								<td></td>
							</tr>
							<tr>
								<th>AWS 통합 빌링(신규)</th>
								<td colspan="5">
									<div class="chkbx">
										<input type="checkbox" name="" id="">
										<label for="">확인</label>
									</div>
								</td>

							</tr>
							<tr>
								<th>특이사항</th>
								<td colspan="5">
									<textarea style="width: 100%; height:100px;" th:field="*{contents}"></textarea>
								</td>

							</tr>
							</table>
						</div>
					</div>
					<!-- 입력 3 -->
					<!-- 입력 4 -->
					<div class="section">
						<div class="subTitle02">
							<h3>고객사 담당자</h3>
							<div>
								<button type="button" class="btn btn-add" onclick="addClient()">담당자 추가</button>
							</div>
						</div>
						<div class="tbl_type02">
							<table id="forList">
							<colgroup>
								<col width="10%">
								<col width="20%">
								<col width="20%">
								<col>
								<col width="20%">
							</colgroup>
							<tr>
								<th class="center">No</th>
								<th class="center">담당자 구분</th>
								<th class="center">이름</th>
								<th class="center">이메일</th>
								<th class="center">비고</th>
							</tr>
							<tr th:each="clientInfo, stat : *{clientInfos}">
								<td class="center" th:text="${stat.index} + 1"></td>
								<td>
									<select th:field="*{clientInfos[__${stat.index}__].type}" style="width:100%;">
										<option th:each="type : *{clientInfos[__${stat.index}__].type.values}"
												th:value="${type.name}"
												th:text="${type.type}">
										</option>
									</select>
								</td>
								<td>
									<input th:field="*{clientInfos[__${stat.index}__].name}" class="inputArea" style="width: 100%;" type="text" th:value="${clientInfo.name}" placeholder="이름" />
								</td>
								<td>
									<input th:field="*{clientInfos[__${stat.index}__].email}" class="inputArea" style="width: 100%;" type="text" th:value="${clientInfo.email}" placeholder="이메일" />
								</td>
								<td>
									<input th:field="*{clientInfos[__${stat.index}__].etc}" class="inputArea" style="width: 100%;" type="text" th:value="${clientInfo.etc}" placeholder="비고" />
								</td>
							</tr>
							</table>
						</div>
					</div>
					<!-- 입력 4 -->

					<!-- 입력 5 -->
					<div class="section">
						<div class="subTitle02">
							<h3>첨부 파일</h3>
						</div>
						<div class="tbl_type02">
							<table>
							<colgroup>
								<col width="20%">
								<col width="60%">
							</colgroup>
							<tr>
								<th class="center">계약서</th>
								<td>
									<input type="file" th:field="*{contractFile}" />
								</td>
							</tr>
							<tr>
								<th class="center">사업자 등록증</th>
								<td>
									<input type="file" th:field="*{businessRegistrationFile}" />
								</td>
							</tr>
							<tr>
								<th class="center">기타</th>
								<td>
									<input type="file" th:field="*{etcFile}" />
								</td>
							</tr>
							</table>
						</div>
					</div>
					<!-- 입력 5 -->

					<!-- 등록 버튼 -->
					<div class="btn-wrap">
						<!--<button type="button" class="btn btn-blue">저장</button>-->
						<!--<button type="button" class="btn btn-navy">등록</button>-->
						<!--<button type="button" class="btn btn-wt">취소</button>-->
						<button type="submit" class="btn btn-navy">등록</button>
						<a th:href="@{/contracts}" class="btn btn-wt">취소</a>
					</div>
					<!-- 버튼 -->

				</form>
			</div>
			<!-- content end -->
		</div>
		<script>
          let rowIndex = 1;
          const fields = {
            type: "담당자 구분",
            name: "이름",
            email: "이메일",
            etc: "비고"
          }

          function addClient() {
            const clonedSelect = document.getElementById("clientInfos0.type").cloneNode(true);
            const table = document.getElementById('forList');
            const newRow = table.insertRow(-1);

            const indexCell = newRow.insertCell(0);
            indexCell.classList.add('center');
            indexCell.textContent = rowIndex + 1;

            Object.keys(fields).forEach((fieldKey, index) => {
              const cell = newRow.insertCell(index + 1);
              const input = document.createElement('input');

              if (fieldKey === 'type') {
                clonedSelect.id =`clientInfos${rowIndex}.${fieldKey}`;
                clonedSelect.name = `clientInfos[${rowIndex}].${fieldKey}`;
                cell.appendChild(clonedSelect);
                return;
              }

              input.classList.add('inputArea');
              input.style.width = '100%';
              input.type = 'text';
              input.value = '';
              input.placeholder = fields[fieldKey];
              input.id = `clientInfos${rowIndex}.${fieldKey}`;
              input.name = `clientInfos[${rowIndex}].${fieldKey}`;
              cell.appendChild(input);
            });

            rowIndex++;
          }
		</script>

		<script>
          $(function () {
            $('#datePickerStart, #datePickerEnd')
              .datepicker();
          });

          function createContract() {
            return confirm("계약을 등록하시겠습니까?");
          }
		</script>
	</div>
</body>
</html>
